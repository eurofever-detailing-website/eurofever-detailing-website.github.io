<div class="mobile-menu" id="mobile-menu" hidden>
  <button class="mobile-menu__close" type="button" aria-label="Close menu">Ã—</button>

  <nav class="mobile-menu__nav" aria-label="Mobile navigation">
    <a class="mobile-menu__link" href="{{ '/' | relative_url }}">HOME</a>
    {%- for path in site.header_pages -%}
      {%- assign my_page = site.html_pages | where: "path", path | first -%}
      {%- if my_page.title -%}
        <a class="mobile-menu__link" href="{{ my_page.url | relative_url }}">
          {{ my_page.title | upcase }}
        </a>
      {%- endif -%}
    {%- endfor -%}
  </nav>
</div>

<script>
  (function () {
    const btn = document.querySelector('.nav-toggle');
    const menu = document.getElementById('mobile-menu');
    const closeBtn = document.querySelector('.mobile-menu__close');
    if (!btn || !menu) return;

    function openMenu(){
      document.documentElement.classList.add('menu-open');
      menu.hidden = false;
      btn.setAttribute('aria-expanded', 'true');
    }

    function closeMenu(){
      document.documentElement.classList.remove('menu-open');
      btn.setAttribute('aria-expanded', 'false');
      menu.hidden = true;
    }

    btn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      const expanded = btn.getAttribute('aria-expanded') === 'true';
      expanded ? closeMenu() : openMenu();
    });

    if (closeBtn) closeBtn.addEventListener('click', (e) => {
      e.preventDefault();
      closeMenu();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && document.documentElement.classList.contains('menu-open')) closeMenu();
    });

    // Close ONLY when a nav link is clicked
    menu.querySelectorAll('a.mobile-menu__link').forEach((a) => {
      a.addEventListener('click', () => closeMenu());
    });
  })();
</script>
