{% assign svc = site.data.services %}
{% assign items = svc.services %}
{% assign sizes = svc.vehicle_sizes %}

<section class="servicesIntroPanel">
  <div class="servicesIntroPanel__inner">

    <span class="servicesIntroPanel__eyebrow">SERVICES</span>

    <h2 class="servicesIntroPanel__title">
      From daily drivers<br>
      to weekend cars
    </h2>

    <p class="servicesIntroPanel__lead">
      Choose the level of care that fits your vehicle.<br>
      Pricing updates based on size.
    </p>

  <div class="serviceComparisons__wrap">

  <div class="serviceComparisons__controls" role="group" aria-label="Vehicle size selector">

    <div class="serviceComparisons__seg" data-vehicle-toggle>

      {% for size in sizes %}
        <button
          type="button"
          class="serviceComparisons__segBtn{% if forloop.first %} is-active{% endif %}"
          data-size="{{ size.key }}">

          <span class="segBtn__label">{{ size.label }}</span>
          <span class="segBtn__desc">{{ size.description }}</span>

        </button>
      {% endfor %}

    </div>
  </div>

  </div>
</section>

<section class="serviceComparisons">

    <div class="serviceComparisons__scroll" role="region" aria-label="Services comparison table" tabindex="0">
      <table class="serviceComparisons__table" role="table">
        <thead>
          <tr>
            <th class="serviceComparisons__th serviceComparisons__th--feature"> </th>

            <th class="serviceComparisons__th serviceComparisons__th--highlight">
              <div class="plan plan--highlight">
                <div class="plan__name">{{ svc.packages.pkg_full_detail.name }}</div>
                <div class="plan__sub">{{ svc.packages.pkg_full_detail.focus }}</div>

                <div class="plan__price" data-price="pkg_full_detail">
                  <span class="plan__priceVal" data-size="small">
                    ${{ svc.packages.pkg_full_detail.pricing.small }}
                  </span>
                  <span class="plan__priceVal" data-size="mid" >
                    ${{ svc.packages.pkg_full_detail.pricing.mid }}
                  </span>
                  <span class="plan__priceVal" data-size="large" >
                    ${{ svc.packages.pkg_full_detail.pricing.large }}
                  </span>
                </div>
              </div>
            </th>

            <th class="serviceComparisons__th">
              <div class="plan">
                <div class="plan__name">{{ svc.packages.pkg_exterior.name }}</div>
                <div class="plan__sub">{{ svc.packages.pkg_exterior.focus }}</div>

                <div class="plan__price" data-price="pkg_exterior">
                  <span class="plan__priceVal" data-size="small">
                    ${{ svc.packages.pkg_exterior.pricing.small }}
                  </span>
                  <span class="plan__priceVal" data-size="mid" >
                    ${{ svc.packages.pkg_exterior.pricing.mid }}
                  </span>
                  <span class="plan__priceVal" data-size="large" >
                    ${{ svc.packages.pkg_exterior.pricing.large }}
                  </span>
                </div>
              </div>
            </th>

            <th class="serviceComparisons__th">
              <div class="plan">
                <div class="plan__name">{{ svc.packages.pkg_interior.name }}</div>
                <div class="plan__sub">{{ svc.packages.pkg_interior.focus }}</div>

                <div class="plan__price" data-price="pkg_interior">
                  <span class="plan__priceVal" data-size="small">
                    ${{ svc.packages.pkg_interior.pricing.small }}
                  </span>
                  <span class="plan__priceVal" data-size="mid" >
                    ${{ svc.packages.pkg_interior.pricing.mid }}
                  </span>
                  <span class="plan__priceVal" data-size="large" >
                    ${{ svc.packages.pkg_interior.pricing.large }}
                  </span>
                </div>
              </div>
            </th>
          </tr>
        </thead>


        <tbody>
          {% assign current_group = "" %}

          {% for item in items %}
            {% assign g = item.group | default: "" %}

            {% if g != "" and g != current_group %}
              {% assign current_group = g %}
              <tr class="serviceComparisons__section">
                <td colspan="4">
                  <span class="serviceComparisons__sectionTitle">{{ current_group | upcase }}</span>
                </td>
              </tr>
            {% endif %}

            <tr class="serviceComparisons__row">
              <th class="serviceComparisons__feature" scope="row">
                <details class="feature">
                  <summary class="feature__summary">
                    <span class="feature__name">{{ item.name }}</span>
                    <span class="feature__toggle"></span>
                  </summary>

                  {% if item.description %}
                    <div class="feature__desc">{{ item.description }}</div>
                  {% endif %}
                </details>
              </th>

              <td class="serviceComparisons__cell">{% include services-cell.html val=item.pkg_full_detail %}</td>
              <td class="serviceComparisons__cell serviceComparisons__cell--highlight">{% include services-cell.html val=item.pkg_exterior %}</td>
              <td class="serviceComparisons__cell">{% include services-cell.html val=item.pkg_interior %}</td>
            </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>

  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.serviceComparisons');
  const toggle = document.querySelector('[data-vehicle-toggle]');
  if (!section || !toggle) return;

  const buttons = toggle.querySelectorAll('[data-size]');

  function setSize(size){
    section.setAttribute('data-active-size', size);
    buttons.forEach(btn =>
      btn.classList.toggle('is-active', btn.dataset.size === size)
    );
  }

  // default
  setSize('small');

  buttons.forEach(btn => {
    btn.addEventListener('click', () => {
      setSize(btn.dataset.size);
    });
  });
});
</script>
